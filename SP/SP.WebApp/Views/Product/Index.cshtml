@model IEnumerable<SP.Application.Dto.ProductDto.ProductViewDto>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="shop__sidebar">
                    <div class="shop__sidebar__search">
                        <form action="#">
                            <input type="text" placeholder="Search...">
                            <button type="submit"><span class="icon_search"></span></button>
                        </form>
                    </div>
                    <div class="shop__sidebar__accordion">
                        <div class="accordion" id="accordionExample">
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseOne">Categories</a>
                                </div>
                                <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__categories">
                                            <ul class="nice-scroll">
                                                @if (ViewBag.Categories != null)
                                                {
                                                    foreach (var category in ViewBag.Categories as SelectList)
                                                    {
                                                        <li class="brand-item">
                                                            <a class="d-block text-dark" href="#">
                                                                @category.Text
                                                            </a>
                                                        </li>
                                                    }
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseTwo">Branding</a>
                                </div>
                                <div id="collapseTwo" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul>
                                                @if (ViewBag.Brands != null)
                                                {
                                                    foreach (var brand in ViewBag.Brands as SelectList)
                                                    {
                                                        <li class="brand-item">
                                                            <a class="d-block text-dark" href="#">
                                                                @brand.Text
                                                            </a>
                                                        </li>
                                                    }
                                                }
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseThree">Filter Price</a>
                                </div>
                                <div id="collapseThree" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__price">
                                            <ul>
                                                <li><a href="#" class="text-dark">Dưới 500.000đ</a></li>
                                                <li><a href="#" class="text-dark">500.000₫ - 1.000.000₫</a></li>
                                                <li><a href="#" class="text-dark">1.000.000₫ - 2.000.000₫</a></li>
                                                <li><a href="#" class="text-dark">2.000.000₫ - 3.000.000₫</a></li>
                                                <li><a href="#" class="text-dark">3.000.000₫ - 4.000.000₫</a></li>
                                                <li><a href="#" class="text-dark">4.000.000₫ - 5.000.000₫</a></li>
                                                <li><a href="#" class="text-dark">Trên 5.000.000đ</a></li>

                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseFour">Size</a>
                                </div>
                                <div id="collapseFour" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__size">
                                            <label for="xs">
                                                xs
                                                <input type="radio" id="xs">
                                            </label>
                                            <label for="sm">
                                                s
                                                <input type="radio" id="sm">
                                            </label>
                                            <label for="md">
                                                m
                                                <input type="radio" id="md">
                                            </label>
                                            <label for="xl">
                                                xl
                                                <input type="radio" id="xl">
                                            </label>
                                            <label for="2xl">
                                                2xl
                                                <input type="radio" id="2xl">
                                            </label>
                                            <label for="xxl">
                                                xxl
                                                <input type="radio" id="xxl">
                                            </label>
                                            <label for="3xl">
                                                3xl
                                                <input type="radio" id="3xl">
                                            </label>
                                            <label for="4xl">
                                                4xl
                                                <input type="radio" id="4xl">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseFive">Colors</a>
                                </div>
                                <div id="collapseFive" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body ml-2">
                                        <div class="shop__sidebar__color">
                                            <label class="c-1" for="sp-1">
                                                <input type="radio" id="sp-1">
                                            </label>
                                            <label class="c-2" for="sp-2">
                                                <input type="radio" id="sp-2">
                                            </label>
                                            <label class="c-3" for="sp-3">
                                                <input type="radio" id="sp-3">
                                            </label>
                                            <label class="c-4" for="sp-4">
                                                <input type="radio" id="sp-4">
                                            </label>
                                            <label class="c-5" for="sp-5">
                                                <input type="radio" id="sp-5">
                                            </label>
                                            <label class="c-6" for="sp-6">
                                                <input type="radio" id="sp-6">
                                            </label>
                                            <label class="c-7" for="sp-7">
                                                <input type="radio" id="sp-7">
                                            </label>
                                            <label class="c-8" for="sp-8">
                                                <input type="radio" id="sp-8">
                                            </label>
                                            <label class="c-9" for="sp-9">
                                                <input type="radio" id="sp-9">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseSix">Phần trăm giảm</a>
                                </div>
                                <div id="collapseSix" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__tags">
                                            @if (ViewBag.Discounts != null)
                                            {
                                                foreach (var discount in ViewBag.Discounts as List<SelectListItem>)
                                                {
                                                    <a href="#">@discount.Text</a>
                                                }
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left">
                                <p>
                                    @if (Model != null)
                                    {
                                        <span class="text-dark">Có @Model.Count() sản phẩm</span>
                                    }
                                    else
                                    {
                                        <span class="text-dark">Không có sản phẩm nào</span>
                                    }
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                                <p>Sắp xếp </p>
                                <select>
                                    <option value="">Bán chạy nhất</option>
                                    <option value="">Mới nhất</option>
                                    <option value="">Giá giảm dần</option>
                                    <option value="">Giá tăng dần</option>
                                    <option value="">Cũ đến mới</option>
                                    <option value="">A-Z</option>
                                    <option value="">Z-A</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="products-grid">
                    @foreach(var item in Model)
                    {
                            <div class="product-card">
                            <div class="product-image">
                                @if (item.ProductVariants != null && item.ProductVariants.FirstOrDefault()?.Images?.Any() == true)
                                {
                                    var variant = item.ProductVariants.First();
                                    var imageFile = variant.Images.FirstOrDefault();
                                    var imageSrc = imageFile?.FileData != null
                                    ? $"data:{imageFile.ContentType};base64,{Convert.ToBase64String(imageFile.FileData)}"
                                    : "";
                                    var altText = imageFile?.FileData != null ? variant.ProductName : "Không có ảnh";

                                    <img src="@imageSrc" alt="@altText" />
                                }
                                else
                                {
                                    <div class="no-image mb-1">Không có ảnh</div>
                                }

                                @if (item.Percent > 0)
                                {
                                    <div class="discount-badge">
                                        <span>-@item.Percent%</span>
                                    </div>
                                }
                            </div>
                                <div class="product-info">
                                    <h6 class="product-title">
                                        @item.ProductName
                                    </h6>

                                <div class="product-brand" style="opacity: 0.6;">
                                    <span>@item.BrandName</span>
                                </div>                              
                                <div class="product-price">
                                    @if (item.ProductVariants != null && item.ProductVariants.Any())
                                    {
                                        var originalPrice = item.ProductVariants.First().Price;
                                        var discountPercent = item.Percent;

                                        if (discountPercent > 0)
                                        {
                                            var discountAmount = originalPrice * discountPercent / 100;
                                            var finalPrice = originalPrice - discountAmount;

                                            <span class="current-price red">
                                                @($"{finalPrice:N0} ₫")
                                            </span>
                                            <span class="original-price">
                                                @($"{originalPrice:N0} ₫")
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="current-price black">
                                                @($"{originalPrice:N0} ₫")
                                            </span>
                                        }
                                    }
                                    else
                                    {
                                        <span class="current-price black">N/A</span>
                                    }
                                </div>
                                @if (item.Rating != null)
                                {
                                    <div class="product-rating">
                                        @{
                                            var rating = item.Rating ?? 0;
                                        }

                                        @for (int i = 0; i < 5; i++)
                                        {
                                            if (i < Math.Floor(rating))
                                            {
                                                <i class="fas fa-star star"></i> <!-- Sao đầy -->
                                            }
                                            else if (i < rating)
                                            {
                                                <i class="fas fa-star-half-alt star"></i> <!-- Nửa sao -->
                                            }
                                            else
                                            {
                                                <i class="fas fa-star star empty"></i> <!-- Sao rỗng -->
                                            }
                                        }

                                        <span>
                                            @rating.ToString("F1")
                                        </span>
                                    </div>
                                }
                            </div>                                                                     
                            </div>
                    }
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__pagination">
                            <a class="active" href="#">1</a>
                            <a href="#">2</a>
                            <a href="#">3</a>
                            <span>...</span>
                            <a href="#">21</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    /* ===== TYPOGRAPHY & BASE STYLES ===== */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
}

.shop {
    padding: 40px 0;
}

/* ===== LAYOUT STRUCTURE ===== */
.row {
    display: flex;
    flex-wrap: wrap;
    margin: 0 -15px;
}

.col-lg-3 {
    flex: 0 0 25%;
    max-width: 25%;
    padding: 0 15px;
}

.col-lg-9 {
    flex: 0 0 75%;
    max-width: 75%;
    padding: 0 15px;
}

/* ===== SIDEBAR STYLES ===== */
.shop__sidebar {
    background: #ffffff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    position: sticky;
    top: 20px;
}

.shop__sidebar__search {
    margin-bottom: 20px;
}

.shop__sidebar__search input {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
}

.shop__sidebar__search button {
    background: none;
    border: none;
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
}

.card {
    margin-bottom: 15px;
    border: none;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.card-heading {
    background: #f8f9fa;
    padding: 12px 15px;
}

.card-heading a {
    color: #333;
    font-weight: 600;
    display: block;
    text-decoration: none;
}

.card-body {
    padding: 15px;
}

/* ===== FILTER STYLES ===== */
.shop__sidebar__categories ul,
.shop__sidebar__brand ul,
.shop__sidebar__price ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

    .current-price.red {
        color: red;
    }

    .current-price.black {
        color: black;
    }

    .original-price {
        text-decoration: line-through;
        color: black;
    }


.shop__sidebar__categories li,
.shop__sidebar__brand li,
.shop__sidebar__price li {
    margin-bottom: 8px;
}

.shop__sidebar__categories a,
.shop__sidebar__brand a,
.shop__sidebar__price a {
    display: block;
    padding: 8px 12px;
    color: #555;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.2s;
    font-size: 14px;
}

.shop__sidebar__categories a:hover,
.shop__sidebar__brand a:hover,
.shop__sidebar__price a:hover {
    background: #f0f2f5;
    color: #333;
}

.shop__sidebar__size {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.shop__sidebar__size label {
    display: inline-block;
    padding: 6px 12px;
    background: #f8f9fa;
    border-radius: 4px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
}

.shop__sidebar__size label:hover {
    background: #e9ecef;
}

.shop__sidebar__color {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}


.shop__sidebar__color label:hover {
    transform: scale(1.1);
}

.shop__sidebar__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.shop__sidebar__tags a {
    display: inline-block;
    padding: 6px 12px;
    background: #f8f9fa;
    border-radius: 4px;
    font-size: 13px;
    color: #555;
    text-decoration: none;
    transition: all 0.2s;
}

.shop__sidebar__tags a:hover {
    background: #e9ecef;
    color: #333;
}

/* ===== PRODUCT GRID ===== */
.shop__product__option {
    margin-bottom: 20px;
    padding: 15px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.product-card {
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    height: 100%;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.product-image {
    height: 180px;
    overflow: hidden;
    position: relative;
    background: #f8f9fa;
    padding: 15px;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image img {
    transform: scale(1.05);
}

.discount-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #ff4757;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.product-info {
    padding: 15px;
}

.product-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
    line-height: 1.4;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-brand {
    font-size: 12px;
    color: #666;
    margin-bottom: 10px;
    opacity: 0.8;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 12px;
}

.star {
    color: #ffd700;
    font-size: 12px;
}

.star.empty {
    color: #ddd;
}

.product-rating span {
    font-size: 12px;
    color: #666;
}

.product-price {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
}

.current-price {
    font-size: 16px;
    font-weight: 700;
    color: #ff4757;
}

.original-price {
    font-size: 13px;
    color: #999;
    text-decoration: line-through;
}

/* ===== PAGINATION ===== */
.product__pagination {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 30px;
}

.product__pagination a {
    display: inline-block;
    width: 36px;
    height: 36px;
    line-height: 36px;
    text-align: center;
    background: #fff;
    border-radius: 50%;
    color: #333;
    text-decoration: none;
    font-size: 14px;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.product__pagination a.active,
.product__pagination a:hover {
    background: #667eea;
    color: #fff;
}

</style>

